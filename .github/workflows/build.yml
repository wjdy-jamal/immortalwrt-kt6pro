name: Build ImmortalWrt for KT-6 Pro

on:
  workflow_dispatch:
  push:
    branches: [ main ]

env:
  BUILD_THREADS: 2  # ุฃูู ูุชูุงุฏู ูุดุงูู ุงูุฐุงูุฑุฉ

jobs:
  build:
    runs-on: ubuntu-latest
    timeout-minutes: 120  # ุณุงุนุชูู ูุญุฏ ุฃูุตู

    steps:
    - name: Checkout Repository
      uses: actions/checkout@v4
      
    - name: Setup Basic Environment
      run: |
        echo "๐ง ุฅุนุฏุงุฏ ุจูุฆุฉ ุงูุจูุงุก ุงูุฃุณุงุณูุฉ..."
        sudo apt-get update
        sudo apt-get install -y build-essential git ccache python3 python3-dev \
          python3-pip python3-setuptools rsync wget curl unzip gawk gettext \
          libncurses-dev libssl-dev zlib1g-dev file
        
    - name: Clone ImmortalWrt (Shallow)
      run: |
        echo "๐ฅ ุงุณุชูุณุงุฎ ImmortalWrt..."
        git clone --depth=1 https://github.com/immortalwrt/immortalwrt.git -b v23.05.3
        cd immortalwrt
        
    - name: Setup Feeds
      run: |
        cd immortalwrt
        echo "๐ฆ ุชุญุฏูุซ Feeds..."
        ./scripts/feeds update -a
        ./scripts/feeds install -a
        
    - name: Configure for KT-6 Pro
      run: |
        cd immortalwrt
        echo "โ๏ธ ุชูููู ูู KT-6 Pro..."
        cat > .config << 'CONFIG'
CONFIG_TARGET_qualcommax=y
CONFIG_TARGET_qualcommax_ipq50xx=y
CONFIG_TARGET_qualcommax_ipq50xx_DEVICE_glinet_gl-ax1800=y

# ุงูุญุฒู ุงูุฃุณุงุณูุฉ
CONFIG_PACKAGE_kmod-ath11k=y
CONFIG_PACKAGE_ath11k-firmware-ipq50xx=y
CONFIG_PACKAGE_kmod-switch-qca8337=y
CONFIG_PACKAGE_swconfig=y
CONFIG_PACKAGE_luci=y
CONFIG_PACKAGE_luci-ssl-openssl=y
CONFIG_PACKAGE_luci-theme-bootstrap=y

# ุฃุฏูุงุช ุฃุณุงุณูุฉ
CONFIG_PACKAGE_openssh-sftp-server=y
CONFIG_PACKAGE_curl=y
CONFIG_PACKAGE_wget=y
CONFIG_PACKAGE_nano=y
CONFIG
        make defconfig
        
    - name: Test Compile
      run: |
        cd immortalwrt
        echo "๐งช ุงุฎุชุจุงุฑ ุงูุชุฑุฌูุฉ (ุฃุฏูุงุช ููุท)..."
        make tools/compile -j${{ env.BUILD_THREADS }} V=s 2>&1 | tail -50
        echo "โ ุงุฎุชุจุงุฑ ุงูุชุฑุฌูุฉ ูุฌุญ"
        
    - name: Prepare for Next Step
      run: |
        echo "๐ฏ ุชู ุฅุนุฏุงุฏ ุจูุฆุฉ ุงูุจูุงุก ุจูุฌุงุญ"
        echo "๐ ุงูุฎุทูุฉ ุงููุงุฏูุฉ: ุงูุจูุงุก ุงููุงูู"
        echo "๐ก ูููู ุงูุขู ุฅุถุงูุฉ ุงูุจูุงุก ุงููุงูู ูู ุงููุฑุญูุฉ ุงูุชุงููุฉ"
        
    - name: Upload Configuration
      uses: actions/upload-artifact@v4
      with:
        name: build-config
        path: immortalwrt/.config
        retention-days: 7
