name: Build ImmortalWrt for KT-6 Pro

on:
  workflow_dispatch:
  push:
    branches: [ main ]

env:
  BUILD_THREADS: 4

jobs:
  build:
    runs-on: ubuntu-22.04
    timeout-minutes: 180

    steps:
    - name: Checkout Repository
      uses: actions/checkout@v4
      with:
        submodules: recursive

    - name: Setup Build Environment
      run: |
        sudo apt-get update
        sudo apt-get install -y build-essential ccache git python3 python3-dev \
          python3-pip python3-setuptools rsync subversion wget curl unzip \
          gawk gettext libncurses-dev libssl-dev zlib1g-dev file
        echo "âœ… Ø§Ù„Ø¨ÙŠØ¦Ø© Ø¬Ø§Ù‡Ø²Ø©"

    - name: Clone ImmortalWrt
      run: |
        git clone --depth=1 https://github.com/immortalwrt/immortalwrt.git -b v23.05.3
        cd immortalwrt
        ./scripts/feeds update -a
        ./scripts/feeds install -a
        echo "âœ… ØªÙ… Ø§Ø³ØªÙ†Ø³Ø§Ø® ImmortalWrt"

    - name: Configure Build
      run: |
        cd immortalwrt
        # Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø£Ø³Ø§Ø³ÙŠØ© Ù„Ù„ØªØ¬Ø±Ø¨Ø©
        cat > .config << 'CONFIG'
CONFIG_TARGET_qualcommax=y
CONFIG_TARGET_qualcommax_ipq50xx=y
CONFIG_TARGET_qualcommax_ipq50xx_DEVICE_glinet_gl-ax1800=y
CONFIG_PACKAGE_kmod-ath11k=y
CONFIG_PACKAGE_ath11k-firmware-ipq50xx=y
CONFIG_PACKAGE_kmod-switch-qca8337=y
CONFIG_PACKAGE_luci=y
CONFIG_PACKAGE_luci-ssl-openssl=y
CONFIG
        # ØªØ´ØºÙŠÙ„ defconfig
        make defconfig
        echo "âœ… Ø§Ù„ØªÙƒÙˆÙŠÙ† Ø¬Ø§Ù‡Ø²"

    - name: Build Test
      run: |
        cd immortalwrt
        echo "ðŸš€ Ø¨Ø¯Ø¡ Ø¨Ù†Ø§Ø¡ ØªØ¬Ø±ÙŠØ¨ÙŠ..."
        echo "ðŸ“± Ø§Ù„Ø¬Ù‡Ø§Ø²: KT-6 Pro (IPQ5018 + QCA8337)"
        make tools/compile -j4
        echo "âœ… Ø§Ù„Ø¨Ù†Ø§Ø¡ Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠ Ù†Ø¬Ø­"

    - name: Show Build Info
      run: |
        echo "ðŸŽ¯ ØªÙ… Ø¥Ø¹Ø¯Ø§Ø¯ Ø¨ÙŠØ¦Ø© Ø§Ù„Ø¨Ù†Ø§Ø¡ Ø¨Ù†Ø¬Ø§Ø­"
        echo "ðŸ”§ Ø§Ù„Ø®Ø·ÙˆØ© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©: Ø¨Ù†Ø§Ø¡ Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„ÙƒØ§Ù…Ù„Ø©"
        echo "â³ Ø³ÙŠØ³ØªØºØ±Ù‚ Ø§Ù„Ø¨Ù†Ø§Ø¡ Ø§Ù„ÙƒØ§Ù…Ù„ 2-3 Ø³Ø§Ø¹Ø§Øª"
        
    - name: Upload Config File
      uses: actions/upload-artifact@v4
      if: always()
      with:
        name: build-config
        path: immortalwrt/.config
        retention-days: 7
